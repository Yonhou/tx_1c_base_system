C51 COMPILER V7.06   TASK                                                                  05/30/2020 16:54:02 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE TASK
OBJECT MODULE PLACED IN task.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\task.c BROWSE DEBUG OBJECTEXTEND PRINT(.\task.lst) OBJECT(task.obj)

stmt level    source

   1          #include <reg51.h>
   2          #include "led.h"
   3          #include "digit_seg.h"
   4          #include "key.h"
   5          #include "app_stopwatch.h"
   6          #include "task.h"
   7          
   8          #define ISR_T0_INTERVAL 918 //918-1ms,1836-2ms,4589-5ms,9179-10ms,45893-50ms
   9          #define ISR_T1_INTERVAL 45902 //0.99998911s as simulation result.  //918-1ms,1836-2ms,4589-5ms,9179-10ms,4
             -5893-50ms
  10          
  11          unsigned char taskCycle_10ms=0;
  12          unsigned char taskCycle_100ms=0;
  13          unsigned int taskCycle_1s=0;
  14          
  15          void tsk_cyclic_10ms(void)
  16          {
  17   1          key_main();
  18   1      }
  19          
  20          void tsk_cyclic_100ms(void)
  21          {
  22   1      
  23   1      }
  24          void tsk_cyclic_1s(void)
  25          {
  26   1          led_flow();
  27   1              app_stopwatch_main();
  28   1      }
  29          void tsk_init(void)
  30          {
  31   1              digital_segment_init();
  32   1      
  33   1      
  34   1              //初始化计时器中断
  35   1              TMOD=0x11;
  36   1              //T0
  37   1              TH0=(65536-ISR_T0_INTERVAL)/256;//晶振频率为11.014357Mhz，机器周期为12/11014357=1.089487112139183us,计1ms
             -需要1000/1.089=918
  38   1              TL0=(65536-ISR_T0_INTERVAL)%256;
  39   1          //T1
  40   1              TH1=(65536-ISR_T1_INTERVAL)/256;//晶振频率为11.014357Mhz，机器周期为12/11014357=1.089487112139183us,计1ms
             -需要1000/1.089=918
  41   1              TL1=(65536-ISR_T1_INTERVAL)%256;
  42   1              EA=1;
  43   1              ET0=1;
  44   1              ET1=1;
  45   1              TR0=1;
  46   1              TR1=1;
  47   1      }
  48          void tsk_schedule(void)
  49          {
  50   1          if(taskCycle_10ms==10)
  51   1              {
  52   2                  taskCycle_10ms=0;
C51 COMPILER V7.06   TASK                                                                  05/30/2020 16:54:02 PAGE 2   

  53   2                  tsk_cyclic_10ms();
  54   2              }
  55   1              if(taskCycle_100ms==2)
  56   1              {
  57   2                  taskCycle_100ms=0;
  58   2                  tsk_cyclic_100ms();
  59   2              }
  60   1              if(taskCycle_1s==20)
  61   1              {
  62   2                  taskCycle_1s=0;
  63   2                  tsk_cyclic_1s();
  64   2              }
  65   1      }
  66          void isr_T0() interrupt 1
  67          {
  68   1          TH0=(65536-ISR_T0_INTERVAL)/256;
  69   1              TL0=(65536-ISR_T0_INTERVAL)%256;
  70   1              digital_seg_cyclic();//Try to avoid shedule task in 1ms interrupt.
  71   1              
  72   1              taskCycle_10ms++;
  73   1      }
  74          
  75          void isr_T1() interrupt 3
  76          {
  77   1          TH1=(65536-ISR_T1_INTERVAL)/256;
  78   1              TL1=(65536-ISR_T1_INTERVAL)%256;
  79   1              //digital_seg_cyclic();//Try to avoid shedule task in 1ms interrupt.
  80   1              
  81   1              taskCycle_100ms++;
  82   1              taskCycle_1s++;
  83   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    165    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
